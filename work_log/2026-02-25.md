# 2026-02-25

## 작업 내용
- Tauri v2 + React 18 + TypeScript 프로젝트 초기화 (create-tauri-app)
- Tailwind CSS v3 설정 (`tailwind.config.js`, `postcss.config.js`)
- SQLite 플러그인 설치 및 DB 초기화 마이그레이션 (`src/db/index.ts`)
  - works, episodes, plots, characters, character_relations 테이블
- Zustand 전역 상태 관리 스토어 구현 (`src/store/index.ts`)
- 좌측 사이드바 구현 (`src/components/Sidebar/index.tsx`)
  - 작품 > 에피소드 > 플롯 트리 UI (CRUD, 인라인 편집)
  - 등장인물 목록 (색상 도트, CRUD)
- 중간 플롯 패널 구현 (`src/components/PlotPanel/index.tsx`)
  - dnd-kit SortableContext 드래그&드롭 순서 변경
  - 플롯 카드 (P1, P2... 번호, 내용 미리보기)
- 우측 TipTap 에디터 구현 (`src/components/Editor/`)
  - 커스텀 노드: SceneHeading, Dialogue, Narration, StageDirection
  - `/` 슬래시 커맨드 메뉴
  - 다중 플롯 탭 뷰 (Cmd+클릭으로 복수 선택)
  - 500ms 디바운스 자동 저장
- 등장인물 상세 패널 (`src/components/CharacterDetail/index.tsx`)
  - 자유 key-value 프로퍼티 편집
  - 관계 추가/삭제 UI
- React Flow 관계도 뷰 (`src/components/GraphView/index.tsx`)
  - 원형 배치 노드, 컬러 엣지
- `.docx` 내보내기 (`src/components/Export/index.tsx`)
  - docx 라이브러리로 서식/색상 포함 export
- `tauri-plugin-dialog`, `tauri-plugin-fs` 추가 (파일 저장 다이얼로그)
- 프론트엔드 빌드 성공 확인 (`npm run build`)

## 결정 사항
- `noUnusedLocals/Parameters` 비활성화: React import 패턴 호환성
- TipTap 슬래시 메뉴: `nodeBefore` 텍스트에서 `/` 감지 방식 채택
- 플롯 자동 저장: 500ms 디바운스 (onUpdate 이벤트)
- 등장인물 색상: 8개 프리셋 + native color picker 병행
- Export: tauri-plugin-dialog로 파일 경로 선택 후 writeFile

## 다음 작업
- Rust 빌드 확인 (`npm run tauri dev`)
  - tauri-plugin-sql, dialog, fs Cargo 의존성 컴파일
- `tauri.conf.json` `plugins.sql.preloadConnections` 정상 동작 확인
- TipTap `setNode('dialogue')` 동작 검증 (character-name 속성 렌더링)
- Shift+Enter 플롯 분리 기능 완성
- `.pdf` export 구현 (@react-pdf/renderer)
- `package.json` name 필드 `--name` → `plot-editor` 수정

## 이슈/메모
- `create-tauri-app` CLI가 `--name` 인수를 폴더명으로 해석하는 버그 있음
  → 생성된 파일을 수동으로 이동하여 해결
- `tauri-plugin-sql` `lastInsertId` 타입이 `number | undefined`
  → `?? 0` 처리로 해결
- 번들 크기 경고 (1.1 MB): 코드 스플리팅 필요 (추후 개선)
- Rust 빌드는 `rustup` 설치 후 진행 가능

---

## 작업 내용 (2회차 — UI/기능 개선)

### 1. 라이트 그레이 테마 전환
- 전체 배경 `#16213e` → `#f4f5f7`, 텍스트 `#e0e0e0` → `#1f2937`
- `src/App.css` `:root` / `body` / 스크롤바 색상 일괄 변경
- `src/App.tsx` 레이아웃 테두리 `border-gray-800` → `border-gray-200`
- `src/components/CharacterDetail/index.tsx` 입력 필드·카드 배경 라이트 계열로 교체
- `src/components/GraphView/index.tsx` ReactFlow 배경·MiniMap 라이트 계열로 교체

### 2. 슬래시 메뉴 키보드 선택 하이라이트 CSS 추가
- `src/App.css`에 `.slash-menu`, `.slash-menu-item`, `.slash-menu-item.active` 스타일 추가
- `.active` 배경 `#e0e7ff` (indigo-100)
- 기존 SlashMenu.tsx 키보드 로직(Arrow Up/Down/Enter)은 이미 구현되어 있었으나 CSS가 없어 시각적 피드백이 없었음

### 3. 대사 서식 Enter 연속성
- `src/components/Editor/nodes.ts` `Dialogue` 노드에 `addKeyboardShortcuts` 추가
- 내용 있는 대사 블록에서 Enter → 동일 인물(characterName, characterColor) 속성으로 새 대사 블록 삽입
- 빈 대사 블록에서 Enter → `setParagraph()`로 일반 단락 전환

### 4. 인물 특성 레이블 명확화
- "프로퍼티" → "특성", "+ 추가" → "+ 항목 추가"
- placeholder "속성명" → "특성 (예: 부유함)", "값" → "설명"

### 5. 관계도 고도화 — 원형 노드 + 방향 화살표
- `CharacterNode` 사각형 → 72×72 원형 (border-radius: 50%)
- 엣지에 `type: 'smoothstep'` + `markerEnd: { type: MarkerType.ArrowClosed }` 추가
- 레이블 배경 `#1a1a35` → `#ffffff`, 레이블 텍스트 `#9ca3af` → `#374151`

---

## 작업 내용 (3회차 — 관계 양방향 표시 + 화살표 수정)

### 관계도 화살표 미표시 버그 수정
- **원인**: 커스텀 `CharacterNode`에 ReactFlow `<Handle>` 컴포넌트가 없어 엣지가 노드 중심에 연결됨 → `markerEnd` 화살표 끝이 원 내부에 가려짐
- **수정**: `CharacterNode`에 투명 Handle 8개 추가 (상/하/좌/우 × source/target, `opacity: 0`)
- `Handle` import 추가 (`from 'reactflow'`)

### 인물 상세 — 관계 양방향 표시
- 기존: `from_character_id === char.id` 인 outgoing 관계만 표시
- 변경: outgoing + incoming 분리 표시
  - **보내는 관계** (흰 배경): `현재인물 → 관계명 → 상대` + 삭제 버튼
  - **받는 관계** (연보라 bg-indigo-50 배경, 읽기 전용): `상대 → 관계명 → 현재인물`
  - a 인물에서 생성한 관계를 b 인물 상세에서도 incoming으로 확인 가능

## 결정 사항 (2·3회차)
- 라이트 테마를 기본으로 확정 (다크 테마 제거)
- 슬래시 메뉴 CSS는 App.css에서 중앙 관리
- 관계도 Handle은 opacity: 0으로 숨겨 UX 유지하되 ReactFlow 엣지 연결 정확도 확보
- incoming 관계 삭제는 해당 관계의 from 인물 상세에서만 가능 (단방향 소유)

## 다음 작업 (prompts/3.md 기반)
- [ ] `.docx` 내보내기 버튼 작동 안 함 — 디버깅 필요 (Tauri fs/dialog 권한 문제 의심)
- [ ] 대사 서식 Enter 연속성 실제 동작 검증 (Rust 빌드 후)
- [ ] 관계도 노드 드래그 재배치 가능 여부 확인 (ReactFlow `draggable` 속성)
- [ ] 관계도 노드 사이드에 인물 특성 표시
- [ ] 인물 상세 — 줄글 메모 공간 추가 (`memo` 컬럼 DB 마이그레이션 필요)

## 이슈/메모 (2·3회차)
- ReactFlow 커스텀 노드에 Handle 없으면 markerEnd 화살표가 노드 뒤에 숨겨짐 → Handle 필수
- Dialogue Enter 단축키: `node.textContent === ''` 체크로 무한 대사 블록 생성 방지
