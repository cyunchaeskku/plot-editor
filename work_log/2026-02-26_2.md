# 2026-02-26 (2차)

## 작업 내용 (prompts/9_add_features.md)

### 1. 다크 모드 / 라이트 모드 토글
- `tailwind.config.js`에 `darkMode: 'class'` 추가
- `App.tsx`에 `darkMode` 상태 추가, `localStorage` 저장/복원
- `document.documentElement`에 `dark` 클래스 토글
- 오른쪽 상단 탭 헤더에 ☀️/🌙 토글 버튼 추가
- 라이트 영역(우측 패널 헤더, 콘텐츠 배경, 테두리 등)에 `dark:` Tailwind 클래스 적용

### 2. 인물 관계도 PNG 내보내기
- `html-to-image` 패키지 설치
- GraphView 우측 상단에 "🖼️ PNG 내보내기" 버튼 추가
- 현재 노드 위치 그대로 캡처 (`pixelRatio: 2` 고해상도), 작품명_관계도.png로 저장

### 3. 인물 색상 변경 시 기존 대사 색 자동 동기화
- `store/index.ts` `updateCharacter` 에서 업데이트 전 oldName 캡처
- 해당 작품의 모든 에피소드/플롯을 순회하며 `dialogue` 노드의 characterName/characterColor 일괄 업데이트 후 DB 저장
- `Editor/index.tsx`에 active plot의 store 콘텐츠 변경 감지 effect 추가 → 외부 변경 시 에디터 자동 리로드

### 4. 사이드바 접기 아이콘 SVG 교체
- `src/assets/sidebar_collapse_icon.svg` 사용
- 펼쳐진 상태: 기본 방향, 접힌 상태: `scaleX(-1)` 반전으로 방향 전환

### 5. 기획서 에디터 → TipTap 리치 에디터 + 내보내기
- `@uiw/react-md-editor` 마크다운 에디터 → TipTap 리치 텍스트 에디터로 교체
- 툴바: 제목 수준(본문/제목1/2/3), B/I/U/S 서식, 글머리 목록, 번호 목록, 인용
- 콘텐츠를 TipTap JSON으로 저장 (기존 마크다운 legacy 데이터는 plain text fallback 처리)
- `.docx 내보내기` 버튼: 제목/서식/목록/인용 구조 유지하여 docx 생성
- `App.css`에 `.planning-editor` 스타일 추가 (다크모드 대응)

### 인물 관계 중복 추가 버그 수정 (선행 작업)
- `CharacterDetail` `handleAddRelation`에서 `await` 전 상태 초기화 (Enter 연타 방지)

## 결정 사항
- 기획서 저장 포맷을 JSON(TipTap)으로 변경; 기존 마크다운 데이터는 첫 로드 시 자동 마이그레이션
- 다크모드는 Tailwind `class` 전략으로 구현, 사이드바/플롯패널은 원래부터 다크이므로 우측 패널 영역만 `dark:` 클래스 추가
- 인물 색 동기화는 이름 기준으로 매핑 (characterId를 dialogue node에 저장하지 않으므로)

## 이슈/메모
- `html-to-image` `toPng`는 ReactFlow의 SVG+HTML 혼합 구조도 잘 캡처함
- docx `HeadingLevel` 타입 사용 시 `typeof HeadingLevel[keyof typeof HeadingLevel]` 형태 필요
- TipTap에서 heading toggle 시 이미 활성화된 같은 레벨이면 paragraph로 전환됨 (기대 동작)
