# 2026-03-04

## 작업 내용

### 커뮤니티 기능 확장 (좋아요, 삭제, 본문, 대댓글)

#### 1. 게시글 좋아요 (`backend/main.py`)

`POST /posts/{post_id}/like` 신규 엔드포인트:
- 로그인 필요. local_id로 게시글 스캔 후 DynamoDB `liked_by` StringSet으로 토글.
- 이미 좋아요 → ADD like_count -1, DELETE liked_by
- 미좋아요 → ADD like_count +1, ADD liked_by
- `{ok, liked, like_count}` 반환.

#### 2. 댓글 좋아요 (`backend/main.py`)

`POST /comments/{comment_id}/like` 신규 엔드포인트:
- 위와 동일한 로직. `liked_by` StringSet 토글.

#### 3. 대댓글 지원 (`backend/main.py`)

`POST /posts/{post_id}/comments` 업데이트:
- body에서 `parent_comment_id` (선택) 추출해 DynamoDB에 저장.
- `GET /posts/{post_id}/comments`는 변경 없음 — 모든 댓글(답글 포함) 반환.

#### 4. 타입 업데이트 (`src/db/index.ts`)

`CommunityComment`에 `parent_comment_id?: string` 필드 추가.

#### 5. Store 업데이트 (`src/store/index.ts`)

- `userSub: string | null` 필드 추가.
- `loadUserInfo`에서 `data.sub`도 저장 (`fetchMe()` 이미 sub 반환 중).

#### 6. API 레이어 (`src/api/index.ts`)

- `normalizeComment`: `parent_comment_id` 포함.
- `apiCreateComment(postId, text, parentCommentId?)`: 선택적 부모 댓글 ID 지원.
- `apiLikePost(postId)` 추가.
- `apiLikeComment(commentId)` 추가.

#### 7. ShareModal (`src/components/ShareModal/index.tsx`)

- "소개 (선택)" 레이블 → "하고 싶은 말"
- placeholder 변경 (예시 문구 포함)

#### 8. PostCard (`src/pages/ThreadBoard/PostCard.tsx`)

- `post.description`을 본문 텍스트로 표시 (line-clamp-2, 작성자 아래)
- ❤ 버튼: `apiLikePost` 호출 + 낙관적 업데이트 (liked/likeCount 로컬 상태)
- `useStore`에서 `isLoggedIn` 읽음 (비로그인 시 버튼 비활성)

#### 9. ThreadDetail (`src/pages/ThreadBoard/ThreadDetail.tsx`)

신규/변경 기능:
- **게시글 본문**: `post.description` 별도 표시 (제목 아래, sm 폰트)
- **게시글 좋아요**: ♡/❤ 버튼, 낙관적 업데이트
- **게시글 삭제**: `post.author_sub === userSub` 시 "삭제" 버튼 노출 → confirm → `apiDeletePost` → `onDeletePost()` 콜백
- **댓글 좋아요**: 각 댓글에 ♡/❤ 버튼, 개별 낙관적 업데이트
- **대댓글**: 상위 댓글에 "답글 달기" 버튼 → 인라인 입력창 → `apiCreateComment(postId, text, parentId)` → 새로고침
- `CommentItem` 재귀 컴포넌트로 댓글+답글 트리 렌더링 (depth=0: 상위, depth=1: 답글)
- `onDeletePost` prop 추가

#### 10. ThreadBoard/index.tsx

`onDeletePost={() => setSelectedPost(null)}` 연결.

## 신규/수정 파일

| 파일 | 변경 |
|---|---|
| `backend/main.py` | POST /posts/{id}/like, POST /comments/{id}/like 추가; create_comment에 parent_comment_id 저장 |
| `src/db/index.ts` | CommunityComment.parent_comment_id 추가 |
| `src/store/index.ts` | userSub 필드 추가 |
| `src/api/index.ts` | apiLikePost, apiLikeComment 추가; apiCreateComment parentCommentId 지원; normalizeComment 업데이트 |
| `src/components/ShareModal/index.tsx` | 레이블/placeholder 변경 |
| `src/pages/ThreadBoard/PostCard.tsx` | 본문 표시, 좋아요 버튼 구현 |
| `src/pages/ThreadBoard/ThreadDetail.tsx` | 대대적 업데이트 (본문, 좋아요, 삭제, 댓글 좋아요, 대댓글) |
| `src/pages/ThreadBoard/index.tsx` | onDeletePost 연결 |

## 검증

- `npm run build` — ✅ 0 TypeScript 오류, 빌드 성공

## 다음 작업

1. Lambda 재배포 (`serverless deploy`) — liked_by StringSet 지원 확인
2. AWS DynamoDB 테이블에 `liked_by` 속성은 자동 생성됨 (Add operation)
3. 실제 로그인 후 좋아요 → 새로고침 시 count 확인
