# 2026-03-03

## ì‘ì—… ë‚´ìš©

### ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€ ê³µìœ  ê¸°ëŠ¥ êµ¬í˜„

#### 1. "ë„“ê²Œ" ë²„íŠ¼ ì œê±°

- `ThreadBoard/index.tsx`: `isExpanded` ìƒíƒœ, `handleExpand`, `handleCollapse` ì œê±°. 2ë‹¨ ë ˆì´ì•„ì›ƒ ê³ ì •.
- `ThreadBoard/ThreadFeed.tsx`: `onExpandPost` prop ì œê±°.
- `ThreadBoard/ThreadDetail.tsx`: `expanded`, `onExpand`, `onCollapse` prop ì œê±° ë° ê´€ë ¨ ë ˆì´ì•„ì›ƒ ë¶„ê¸° ì œê±°.
- `ThreadBoard/PostCard.tsx`: `onExpand` prop ì œê±°. "ìì„¸íˆ ë³´ê¸°" ë²„íŠ¼ì´ `onClick` í˜¸ì¶œë¡œ ë³€ê²½.

#### 2. íƒ€ì… ì •ì˜ (`src/db/index.ts`)

`dummyData.ts`ì— ìˆë˜ íƒ€ì…ë“¤ì„ ì¤‘ì•™ íƒ€ì… íŒŒì¼ë¡œ ì´ë™:
- `PostDialogue`, `PlotContentPreview`, `PlotBlockType`, `PlotBlock`, `PlotScene`, `PlotFullContent`
- `NovelContentPreview`, `NovelFullContent`
- ì‹ ê·œ: `PlotCommunityPost`, `NovelCommunityPost`, `CommunityPost` (discriminated union)
- ì‹ ê·œ: `CommunityComment`

`CommunityPost.id`ëŠ” `string` íƒ€ì… (`{sub}#{local_id}` í˜•ì‹).

#### 3. TipTap â†’ Snapshot ë³€í™˜ ìœ í‹¸ (`src/utils/tiptapToSnapshot.ts`)

- `tiptapToSnapshot(tiptapJson, workType, chapterTitle)` í•¨ìˆ˜ ì‘ì„±
- Plot ëª¨ë“œ: `sceneHeading` ë…¸ë“œ ê¸°ì¤€ ì”¬ ë¶„ë¦¬, `dialogue/narration/stageDirection` ë¸”ë¡ ìˆ˜ì§‘
- Novel ëª¨ë“œ: `paragraph` ë…¸ë“œë¥¼ ë‹¨ë½ìœ¼ë¡œ ìˆ˜ì§‘
- `SnapshotResult` ë°˜í™˜: `{ fullContent, contentPreview }`

#### 4. ë°±ì—”ë“œ ì—”ë“œí¬ì¸íŠ¸ (`backend/main.py`)

DynamoDB í…Œì´ë¸” 2ê°œ ì¶”ê°€:
- `community_posts` (`_posts_table`)
- `community_comments` (`_comments_table`)

í—¬í¼ í•¨ìˆ˜:
- `_sub_to_color(sub)`: Cognito sub â†’ ê²°ì •ë¡ ì  hex ìƒ‰ìƒ (HSL ê¸°ë°˜, ê°€ë…ì„± ìˆëŠ” ë²”ìœ„)
- `_author_name_from_email(email)`: `@` ì• ë¶€ë¶„ ì¶”ì¶œ
- `_decode_token_payload(request)`: JWTì—ì„œ email ë“± payload ì¶”ì¶œ

ì—”ë“œí¬ì¸íŠ¸ (8ê°œ ì¶”ê°€):
- `GET /posts` â€” ì „ì²´ ê³µê°œ ê²Œì‹œê¸€ ìµœì‹ ìˆœ 50ê°œ (ì¸ì¦ ë¶ˆí•„ìš”)
- `GET /posts/mine` â€” ë‚´ ê²Œì‹œê¸€ (ë¡œê·¸ì¸ í•„ìš”)
- `POST /posts` â€” ê²Œì‹œê¸€ ìƒì„± + S3 snapshot ì—…ë¡œë“œ
- `DELETE /posts/{id}` â€” ê²Œì‹œê¸€ ì‚­ì œ (ë³¸ì¸ë§Œ) + S3 ì‚­ì œ
- `GET /posts/{id}/content` â€” S3ì—ì„œ snapshot ì¡°íšŒ
- `GET /posts/{id}/comments` â€” ëŒ“ê¸€ ëª©ë¡
- `POST /posts/{id}/comments` â€” ëŒ“ê¸€ ì‘ì„± + comment_count +1
- `DELETE /comments/{id}` â€” ëŒ“ê¸€ ì‚­ì œ + comment_count -1

#### 5. API ë ˆì´ì–´ (`src/api/index.ts`)

ì¶”ê°€ í•¨ìˆ˜:
- `fetchPosts()`, `fetchMyPosts()`, `apiCreatePost(data)`, `apiDeletePost(postId)`
- `fetchPostContent(postId)`, `fetchComments(postId)`, `apiCreateComment(postId, text)`, `apiDeleteComment(commentId)`
- `normalizePost()`, `normalizeComment()` ë‚´ë¶€ í—¬í¼

#### 6. ShareModal (`src/components/ShareModal/index.tsx`)

ì‹ ê·œ ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸:
- `work`, `episode`, `plot` props ë°›ì•„ pre-fill
- ê²Œì‹œê¸€ ì œëª© input, ì„¤ëª… textarea, íƒœê·¸ input (ì‰¼í‘œ êµ¬ë¶„)
- `tiptapToSnapshot`ìœ¼ë¡œ preview ìƒì„± í›„ í‘œì‹œ (plot: ì”¬ ë¯¸ë¦¬ë³´ê¸°, novel: ì±•í„°+ë°œì·Œ)
- `apiCreatePost` í˜¸ì¶œ â†’ ì„±ê³µ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
- Esc í‚¤, ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°

#### 7. EditorPage "ê³µìœ í•˜ê¸°" ë²„íŠ¼

- `selectedPlotIds[0]` (plot ëª¨ë“œ) ë˜ëŠ” `novelChapterPlotId` (novel ëª¨ë“œ)ë¡œ í˜„ì¬ í™œì„± plot íƒìƒ‰
- ë¡œê·¸ì¸ + í™œì„± plot ì¡°ê±´ ì‹œ `ğŸ“¤ ê³µìœ í•˜ê¸°` ë²„íŠ¼ ë…¸ì¶œ
- ë²„íŠ¼ í´ë¦­ ì‹œ ShareModal ë Œë”ë§

#### 8. ThreadBoard ì‹¤ì œ API ì—°ê²°

**ThreadFeed.tsx:**
- ë§ˆìš´íŠ¸ / íƒ­ ë³€ê²½ ì‹œ `fetchPosts()` ë˜ëŠ” `fetchMyPosts()` í˜¸ì¶œ
- ë¡œë”© ìŠ¤í”¼ë„ˆ + ì—ëŸ¬ + ì¬ì‹œë„ ë²„íŠ¼
- `DUMMY_POSTS` ì˜ì¡´ ì™„ì „ ì œê±°
- "+ ê³µìœ í•˜ê¸°" ë²„íŠ¼: ë¡œê·¸ì¸ ì‹œì—ë§Œ í‘œì‹œ, í´ë¦­ ì‹œ `onNewPost()` (ì—ë””í„°ë¡œ ì´ë™)

**ThreadDetail.tsx:**
- post ë³€ê²½ ì‹œ `fetchComments(post.id)` í˜¸ì¶œ (useEffect)
- ëŒ“ê¸€ ë“±ë¡: `apiCreateComment` â†’ ì„±ê³µ ì‹œ re-fetch
- ë¦¬ë” ëª¨ë“œ: `fetchPostContent(post.id)` ë¡œ lazy ë¡œë“œ
- `DUMMY_COMMENTS` ì˜ì¡´ ì™„ì „ ì œê±°
- ëŒ“ê¸€ ì…ë ¥ì°½: ë¡œê·¸ì¸ ì‚¬ìš©ìì—ê²Œë§Œ í‘œì‹œ

**dummyData.ts**: ë” ì´ìƒ importë˜ì§€ ì•ŠìŒ (íŒŒì¼ ìì²´ëŠ” ë‚¨ê²¨ë‘ ).

## ì‹ ê·œ/ìˆ˜ì • íŒŒì¼

| íŒŒì¼ | ë³€ê²½ |
|---|---|
| `src/db/index.ts` | CommunityPost, CommunityComment, content types ì¶”ê°€ |
| `src/api/index.ts` | posts/comments API í•¨ìˆ˜ ì¶”ê°€ |
| `src/utils/tiptapToSnapshot.ts` | ì‹ ê·œ |
| `src/components/ShareModal/index.tsx` | ì‹ ê·œ |
| `src/pages/EditorPage.tsx` | ê³µìœ í•˜ê¸° ë²„íŠ¼ ì¶”ê°€ |
| `src/pages/ThreadBoard/index.tsx` | expand ì œê±°, useNavigate |
| `src/pages/ThreadBoard/ThreadFeed.tsx` | ì‹¤ì œ API ì—°ê²° |
| `src/pages/ThreadBoard/ThreadDetail.tsx` | ì‹¤ì œ API ì—°ê²°, expand ì œê±° |
| `src/pages/ThreadBoard/PostCard.tsx` | onExpand ì œê±° |
| `backend/main.py` | posts/comments ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ |

## ê²€ì¦

- `npm run build` â€” âœ… 0 TypeScript ì˜¤ë¥˜, ë¹Œë“œ ì„±ê³µ

## ë‹¤ìŒ ì‘ì—…

1. AWS DynamoDB `community_posts`, `community_comments` í…Œì´ë¸” ìƒì„± (ë°°í¬ ì „)
2. Lambda ì¬ë°°í¬ (`serverless deploy`)
3. ì‹¤ì œ ë¡œê·¸ì¸ í›„ ê³µìœ  â†’ í”¼ë“œ í™•ì¸
4. `dummyData.ts` íŒŒì¼ ì‚­ì œ (ì™„ì „íˆ ë¯¸ì‚¬ìš© í™•ì¸ í›„)
